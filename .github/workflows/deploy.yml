
name: kibana install & then Uninstall
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  update_packages:
    runs-on: ubuntu-latest
    environment: test
    env: # Or as an environment variable
      SSH_KEY: ${{ secrets.SSH_KEY }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Uninstall the old packages
        run: |
          echo $SSH_KEY > ssh_file.pem
          chmod 600 ssh_file.pem
          ssh -i ssh_file.pem -o StrictHostKeyChecking=no ec2-user@54.144.78.186 'bash -s' < ./uninstall.sh
      - name: Installing new packages
        run: |
          echo $SSH_KEY > ssh_file.pem
          chmod 600 ssh_file.pem
          ssh  -i ssh_file.pem -o StrictHostKeyChecking=no ec2-user@54.144.78.186 'bash -s' < ./install.sh
      - name: Verify the Package
        run: |
          echo $SSH_KEY > ssh_file.pem
          chmod 600 ssh_file.pem
          ssh  -i ssh_file.pem -o StrictHostKeyChecking=no ec2-user@54.144.78.186 'bash -s' < ./verify.sh
